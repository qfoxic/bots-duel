"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{6589:(e,t,r)=>{r.r(t),r.d(t,{GameDashboard:()=>g,MY_TURN_COLOR:()=>x,OPP_TURN_COLOR:()=>b});var n=r(5155),s=r(2577),a=r(6011),l=r(2758),i=function(e){return e.ME="me",e.OPP="opp",e.DRAW="draw",e}({}),o=r(9026),d=r(63),u=r(2115),c=r(6716);let m=13*o.Zm,p=13*o.Nr,x="#ef4444",b="#3b82f6",h={1:x,2:b,3:"#111827",4:"#7c3aed",5:"#6d28d9"},f=(e,t)=>t*o.Zm+e;function g(e){var t;let{initialTournament:r,currentBot:b}=e,{onMessage:g,sendWebSocketMessage:w}=(0,s.E)(),{currentTournament:v,setCurrentTournament:y,setTournaments:N}=(0,a.Y)(),j=(0,d.useRouter)(),[C,k]=(0,u.useState)(r.owner.id===b.id?null:r.owner),[T,E]=(0,u.useState)(r.owner),R=(0,u.useRef)([]),O=(0,u.useRef)(null),[D,M]=u.useState({title:""}),[A,_]=u.useState(!1),P=u.useRef(!1),Y=(0,u.useRef)({myCaptures:0,oppCaptures:0}),U=(0,u.useRef)(r.owner.id===b.id?null:r.owner),F=u.useCallback(e=>{var t;let r=Math.min(e.length,o.Nr*o.Zm);for(let t=0;t<r;t++){let r=e[t];if(0===r)continue;let n=R.current[t];if(!n)continue;let s=h[r];s&&n.setAttrs({fill:s,listening:!1})}null==(t=O.current)||t.batchDraw()},[]),L=(0,u.useMemo)(()=>{let e=[];for(let t=0;t<o.Nr;t++)for(let r=0;r<o.Zm;r++)e.push((0,n.jsx)(c.rw,{name:"".concat(r,"-").concat(t),x:13*r,y:13*t,width:13,height:13,fill:"#9ca3af",stroke:"#374151",strokeWidth:.5,ref:e=>{R.current&&(R.current[f(r,t)]=e)}},"".concat(r,"-").concat(t)));return e},[]);return(0,u.useEffect)(()=>{U.current=C},[C]),(0,u.useEffect)(()=>{P.current=A},[A]),(0,u.useEffect)(()=>{let e=g("JoinTournament",e=>{P.current||(y(e.tournament),k(e.tournament.bot),b.type===l.Y.AUTO&&w({type:"TournamentAskForCoord",tournament:{...e.tournament,bot:b}}))}),t=g("TournamentMoveDone",e=>{if(P.current)return;let{tournament:t,grid:r,resolution:n}=e;if(y(t),E(b.id===t.bot.id?U.current:b),F(r||[]),n){let{me:e,opp:r,winner:s}=n;if(Y.current.myCaptures=e,Y.current.oppCaptures=r,s){let e;e="Draw ".concat(Y.current.myCaptures,":").concat(Y.current.oppCaptures),s===i.ME?e="You win ".concat(Y.current.myCaptures,":").concat(Y.current.oppCaptures):s===i.OPP&&(e="You lose ".concat(Y.current.myCaptures,":").concat(Y.current.oppCaptures)),M({title:e}),w({type:"TournamentFinished",tournament:{...t,bot:b},winner:s===i.DRAW?"":s===i.ME?b.id:U.current.id}),_(!0)}}b.type===l.Y.AUTO&&b.id!==t.bot.id&&w({type:"TournamentAskForCoord",tournament:{...e.tournament,bot:b}})}),r=g("TournamentAskForCoord",e=>{if(P.current)return;let{coord:t}=e,[r,n]=t;w({type:"TournamentMoveDone",tournament:{...e.tournament,bot:b},move:[r,n]})});return()=>{t(),r(),e()}},[F,b,g,w,y]),(0,n.jsx)("div",{className:"min-h-screen w-full bg-gray-950 text-gray-100",children:(0,n.jsxs)("div",{className:"p-4 grid grid-cols-1 lg:grid-cols-[clamp(260px,24vw,320px)_minmax(0,1fr)] gap-4",children:[(0,n.jsx)("aside",{className:"rounded-2xl border border-white/10 bg-gray-900/60 shadow-lg p-4 h-[min(80vh,calc(100vh-48px))] flex flex-col gap-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-gray-800/80 to-gray-800/40 p-3 shadow\n              ".concat((null==T?void 0:T.id)===b.id?"ring-2 ring-red-400/30":""),children:[(0,n.jsxs)("div",{className:"flex w-full items-center gap-2 flex-wrap",children:[(0,n.jsx)("span",{className:"flex-auto min-w-0 text-base font-semibold truncate\n                  ".concat((null==T?void 0:T.id)===b.id?"text-red-400":"text-red-300"),children:b.id}),(null==T?void 0:T.id)===b.id&&(0,n.jsx)("span",{className:"flex-none text-[10px] px-2 py-0.5 rounded-full border border-red-400/30 bg-red-500/10 text-red-300",children:"turn"})]}),(0,n.jsx)("div",{className:"mt-3 text-xs",children:(0,n.jsxs)("div",{className:"rounded-lg bg-white/5 border border-white/10 px-2 py-1.5 flex items-center justify-between",children:[(0,n.jsx)("span",{className:"opacity-70",children:"Captures"}),(0,n.jsx)("span",{className:"tabular-nums text-red-300 font-medium",children:Y.current.myCaptures})]})})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-gray-800/80 to-gray-800/40 p-3 shadow\n              ".concat((null==T?void 0:T.id)===(null==C?void 0:C.id)?"ring-2 ring-blue-400/30":""),children:[(0,n.jsxs)("div",{className:"flex w-full items-center gap-2 flex-wrap",children:[(0,n.jsx)("span",{className:"flex-auto min-w-0 text-base font-semibold truncate\n                  ".concat((null==T?void 0:T.id)===(null==C?void 0:C.id)?"text-blue-400":"text-blue-300"),children:null!=(t=null==C?void 0:C.id)?t:"waiting..."}),(null==T?void 0:T.id)===(null==C?void 0:C.id)&&(0,n.jsx)("span",{className:"flex-none text-[10px] px-2 py-0.5 rounded-full border border-blue-400/30 bg-blue-500/10 text-blue-300",children:"turn"})]}),(0,n.jsx)("div",{className:"mt-3 text-xs",children:(0,n.jsxs)("div",{className:"rounded-lg bg-white/5 border border-white/10 px-2 py-1.5 flex items-center justify-between",children:[(0,n.jsx)("span",{className:"opacity-70",children:"Captures"}),(0,n.jsx)("span",{className:"tabular-nums text-blue-300 font-medium",children:Y.current.oppCaptures})]})})]})]})}),(0,n.jsxs)("main",{className:"rounded-2xl border border-white/10 bg-gray-900/60 shadow-xl p-4 relative overflow-hidden h-[min(80vh,calc(100vh-48px))] flex flex-col",children:[(0,n.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-auto",children:(0,n.jsx)(c.BI,{width:m,height:p,children:(0,n.jsx)(c.Wd,{ref:O,onClick:e=>{var t;if(P.current)return;let r=e.target;if(!r||"Rect"!==r.getClassName()||(null==v?void 0:v.status)!=="active"||!b||!T||T.id!==b.id||b.type===l.Y.AUTO)return;let[n,s]=(r.name()||"").split("-"),a=parseInt(n,10),i=parseInt(s,10);E(U.current),r.setAttrs({fill:x,listening:!1}),null==(t=O.current)||t.batchDraw(),w({type:"TournamentMoveDone",tournament:{...v,bot:b},move:[a,i]})},children:L})})}),A&&(0,n.jsx)("div",{className:"pointer-events-none absolute top-3 inset-x-0 z-20 flex justify-center",children:(0,n.jsxs)("div",{className:"pointer-events-auto flex items-center gap-3 rounded-full border border-white/10 bg-gray-900/95 px-4 py-2 shadow-lg backdrop-blur supports-[backdrop-filter]:backdrop-blur-sm",children:[(0,n.jsx)("div",{className:"flex items-baseline gap-2 min-w-0",children:(0,n.jsx)("span",{className:"text-sm font-semibold truncate",children:D.title})}),(0,n.jsx)("button",{type:"button",onClick:()=>{v&&N(e=>e.map(e=>e.id===v.id?{...e,participants:[],status:o.me.COMPLETED}:e)),y(null),j.push("/")},className:"ml-1 inline-flex items-center rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-xs hover:bg-white/15",children:"Train bot"}),(0,n.jsx)("button",{type:"button",onClick:()=>{v&&N(e=>e.map(e=>e.id===v.id?{...e,participants:[],status:o.me.COMPLETED}:e)),y(null),j.push("/")},className:"ml-1 inline-flex items-center rounded-md border border-white/10 bg-white/10 px-3 py-1.5 text-xs hover:bg-white/15",children:"Back to tournaments"})]})})]})]})})}}}]);