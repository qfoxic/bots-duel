(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1290:()=>{},2577:(e,t,r)=>{"use strict";r.d(t,{BotsProvider:()=>d,E:()=>f});var n,u=r(5155),c=r(2115),o=r(2758),s=r(5704);let l="dots-duel-current-bot",a=null!=(n=s.env.NEXT_PUBLIC_WS_URL)?n:"ws://localhost:8000",i=(0,c.createContext)(void 0);function d(e){let{children:t}=e,[r,n]=(0,c.useState)(null),[s,d]=(0,c.useState)("disconnected"),f=(0,c.useRef)(null),S=(0,c.useRef)(0),h=(0,c.useRef)(null),b=(0,c.useRef)(new Map),k=(0,c.useRef)(new Map),m=()=>{h.current&&(clearTimeout(h.current),h.current=null)};function v(e){let t=b.current.get(e);if(!t||0===t.size)return;let r=k.current.get(e);if(!r||0===r.length)return;let n=r.splice(0,r.length);for(let r of(k.current.set(e,[]),n))for(let e of t)try{e(r)}catch(e){console.error(e)}}let N=(0,c.useCallback)(e=>!!f.current&&f.current.readyState===WebSocket.OPEN&&(f.current.send(JSON.stringify(e)),!0),[]),g=(0,c.useCallback)(e=>{try{sessionStorage.setItem(l,JSON.stringify(e))}catch(e){}},[]),C=(0,c.useCallback)(()=>{try{{let e=sessionStorage.getItem(l);return e?JSON.parse(e):null}}catch(e){return null}},[]),y=(0,c.useCallback)((e,t)=>{let r=b.current.get(e);return r||(r=new Set,b.current.set(e,r)),r.add(t),v(e),()=>{let r=b.current.get(e);r&&(r.delete(t),0===r.size&&b.current.delete(e))}},[]),p=(0,c.useCallback)(()=>{let e=C();if(!e||f.current&&(f.current.readyState===WebSocket.OPEN||f.current.readyState===WebSocket.CONNECTING))return;m(),d("connecting");let t=new WebSocket("".concat(a,"/ws/").concat(e.id));f.current=t,t.onopen=()=>{S.current=0,d("connected")},t.onmessage=e=>{try{var t,r=JSON.parse(e.data);let n=null!=(t=k.current.get(r.type))?t:[];n.push(r),k.current.set(r.type,n),v(r.type)}catch(e){console.error("Error parsing WebSocket message:",e)}},t.onclose=e=>{if(f.current=null,d("disconnected"),1e3!==e.code){let e=Math.min(S.current+1,5);S.current=e;let t=Math.min(1e3*2**(e-1),8e3);m(),h.current=setTimeout(()=>p(),t)}},t.onerror=()=>{d("error")}},[]),E=(0,c.useCallback)(()=>{m();let e=f.current;if(f.current=null,e)try{(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close(1e3)}catch(e){}},[]);(0,c.useEffect)(()=>{p();let e=C(),t=null!=e?e:{id:Math.random().toString().slice(2,10),type:o.Y.MANUAL};return n(t),e||g(t),()=>{E()}},[]);let P=(0,c.useMemo)(()=>({saveBotToSession:g,currentBot:r,setCurrentBot:n,connectionStatus:s,sendWebSocketMessage:N,onMessage:y,connectWebSocket:p,disconnectWebSocket:E}),[p,s,r,E,y,g,N]);return(0,u.jsx)(i.Provider,{value:P,children:t})}function f(){let e=(0,c.useContext)(i);if(!e)throw Error("useBots must be used within a BotsProvider");return e}},2758:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var n=function(e){return e.AUTO="auto",e.MANUAL="manual",e}({})},6011:(e,t,r)=>{"use strict";r.d(t,{TournamentsProvider:()=>o,Y:()=>s});var n=r(5155),u=r(2115);let c=(0,u.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,u.useState)([]),[s,l]=(0,u.useState)(null);return(0,n.jsx)(c.Provider,{value:{tournaments:r,setTournaments:o,currentTournament:s,setCurrentTournament:l},children:t})}function s(){let e=(0,u.useContext)(c);if(void 0===e)throw Error("useTournaments must be used within a TournamentsProvider");return e}},9084:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1290,23)),Promise.resolve().then(r.bind(r,2577)),Promise.resolve().then(r.bind(r,6011))}},e=>{e.O(0,[741,441,255,358],()=>e(e.s=9084)),_N_E=e.O()}]);