(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{63:(e,t,r)=>{"use strict";var n=r(7260);r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},2577:(e,t,r)=>{"use strict";r.d(t,{BotsProvider:()=>d,E:()=>m});var n,s=r(5155),a=r(2115),o=r(2758),c=r(5704);let l="dots-duel-current-bot",i=null!=(n=c.env.NEXT_PUBLIC_WS_URL)?n:"ws://localhost:8000",u=(0,a.createContext)(void 0);function d(e){let{children:t}=e,[r,n]=(0,a.useState)(null),[c,d]=(0,a.useState)("disconnected"),m=(0,a.useRef)(null),x=(0,a.useRef)(0),g=(0,a.useRef)(null),b=(0,a.useRef)(new Map),h=(0,a.useRef)(new Map),p=()=>{g.current&&(clearTimeout(g.current),g.current=null)};function f(e){let t=b.current.get(e);if(!t||0===t.size)return;let r=h.current.get(e);if(!r||0===r.length)return;let n=r.splice(0,r.length);for(let r of(h.current.set(e,[]),n))for(let e of t)try{e(r)}catch(e){console.error(e)}}let y=(0,a.useCallback)(e=>!!m.current&&m.current.readyState===WebSocket.OPEN&&(m.current.send(JSON.stringify(e)),!0),[]),N=(0,a.useCallback)(e=>{try{sessionStorage.setItem(l,JSON.stringify(e))}catch(e){}},[]),v=(0,a.useCallback)(()=>{try{{let e=sessionStorage.getItem(l);return e?JSON.parse(e):null}}catch(e){return null}},[]),w=(0,a.useCallback)((e,t)=>{let r=b.current.get(e);return r||(r=new Set,b.current.set(e,r)),r.add(t),f(e),()=>{let r=b.current.get(e);r&&(r.delete(t),0===r.size&&b.current.delete(e))}},[]),j=(0,a.useCallback)(()=>{let e=v();if(!e||m.current&&(m.current.readyState===WebSocket.OPEN||m.current.readyState===WebSocket.CONNECTING))return;p(),d("connecting");let t=new WebSocket("".concat(i,"/ws/").concat(e.id));m.current=t,t.onopen=()=>{x.current=0,d("connected")},t.onmessage=e=>{try{var t,r=JSON.parse(e.data);let n=null!=(t=h.current.get(r.type))?t:[];n.push(r),h.current.set(r.type,n),f(r.type)}catch(e){console.error("Error parsing WebSocket message:",e)}},t.onclose=e=>{if(m.current=null,d("disconnected"),1e3!==e.code){let e=Math.min(x.current+1,5);x.current=e;let t=Math.min(1e3*2**(e-1),8e3);p(),g.current=setTimeout(()=>j(),t)}},t.onerror=()=>{d("error")}},[]),C=(0,a.useCallback)(()=>{p();let e=m.current;if(m.current=null,e)try{(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close(1e3)}catch(e){}},[]);(0,a.useEffect)(()=>{j();let e=v(),t=null!=e?e:{id:Math.random().toString().slice(2,10),type:o.Y.MANUAL};return n(t),e||N(t),()=>{C()}},[]);let S=(0,a.useMemo)(()=>({saveBotToSession:N,currentBot:r,setCurrentBot:n,connectionStatus:c,sendWebSocketMessage:y,onMessage:w,connectWebSocket:j,disconnectWebSocket:C}),[j,c,r,C,w,N,y]);return(0,s.jsx)(u.Provider,{value:S,children:t})}function m(){let e=(0,a.useContext)(u);if(!e)throw Error("useBots must be used within a BotsProvider");return e}},2758:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var n=function(e){return e.AUTO="auto",e.MANUAL="manual",e}({})},6011:(e,t,r)=>{"use strict";r.d(t,{TournamentsProvider:()=>o,Y:()=>c});var n=r(5155),s=r(2115);let a=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,s.useState)([]),[c,l]=(0,s.useState)(null);return(0,n.jsx)(a.Provider,{value:{tournaments:r,setTournaments:o,currentTournament:c,setCurrentTournament:l},children:t})}function c(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useTournaments must be used within a TournamentsProvider");return e}},7424:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(5155),s=r(63),a=r(2115),o=r(9026),c=r(2758),l=r(2577),i=r(6011);let u={active:"bg-green-100 text-green-800",upcoming:"bg-yellow-100 text-yellow-800",completed:"bg-gray-100 text-gray-800"},d=e=>{let{tournament:t,currentBot:r,onJoin:s}=e,{status:a}=t,o=r&&"upcoming"===a;return(0,n.jsx)("div",{className:"px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("div",{className:"text-lg font-semibold text-gray-800",children:[t.owner.id,t.owner.id===r.id&&(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(u[a]),children:"owner"})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(u[a]),children:a}),o&&(0,n.jsx)("button",{onClick:()=>s(t),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-lg transition-colors",children:"Join"})]})]})})},m=e=>{let{status:t}=e;return(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat({connected:"bg-green-500",connecting:"bg-yellow-500",error:"bg-red-500",disconnected:"bg-gray-400"}[t])}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:t.charAt(0).toUpperCase()+t.slice(1)})]})},x=e=>{let{title:t,color:r,children:s}=e;return(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800 flex items-center",children:t}),(0,n.jsx)("div",{className:"space-y-3",children:s})]})};function g(){let{currentBot:e,connectionStatus:t,setCurrentBot:r,sendWebSocketMessage:u,onMessage:g,saveBotToSession:b}=(0,l.E)(),{tournaments:h,setTournaments:p,currentTournament:f,setCurrentTournament:y}=(0,i.Y)(),N=(0,s.useRouter)(),v=t=>{e&&(y(t),u({type:"JoinTournament",tournament:{...t,bot:e}}),N.push("/match"))},w=t=>{e&&(e.type=t,b(e),r({...e}))};return(0,a.useEffect)(()=>{let e=g("JoinTournament",e=>{p(t=>{let r=t.findIndex(t=>t.id===e.tournament.id);if(!(r>=0))return[...t,e.tournament];{let n=[...t];return n[r]=e.tournament,n}})}),t=g("CreateTournament",e=>{p(t=>[...t,e.tournament])});return()=>{e(),t()}},[g,p]),(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-8",children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[e&&(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("h2",{className:"text-xl font-bold text-gray-800 truncate",children:[e.id," ",(0,n.jsx)("span",{children:(0,n.jsx)(m,{status:t})})]}),(0,n.jsx)("div",{className:"mt-1 flex items-center gap-4 flex-wrap",children:(0,n.jsx)("div",{className:"flex items-center gap-2 text-sm",children:(0,n.jsxs)("div",{className:"inline-flex rounded-md border border-gray-300 bg-white",children:[(0,n.jsx)("button",{type:"button",onClick:()=>w(c.Y.MANUAL),className:"px-2.5 py-1 text-xs transition ".concat(e.type===c.Y.MANUAL?"bg-gray-900 text-white":"text-gray-700 hover:bg-gray-50"),children:"manual bot"}),(0,n.jsx)("button",{type:"button",onClick:()=>w(c.Y.AUTO),className:"px-2.5 py-1 text-xs transition border-l border-gray-300 ".concat(e.type===c.Y.AUTO?"bg-gray-900 text-white":"text-gray-700 hover:bg-gray-50"),children:"auto bot"})]})})})]}),(0,n.jsx)("button",{onClick:()=>{if(!e)return;let t={id:Math.random().toString().substring(2,10),owner:e,bot:e,status:o.me.UPCOMING,participants:[e.id],dims:[o.Nr,o.Zm]};y(t),p(e=>[...e,t]),u({type:"CreateTournament",tournament:t})},disabled:!!f,className:"px-4 py-2 font-semibold rounded-lg transition-colors ".concat(f?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white cursor-pointer"),children:"Create Tournament"})]})}),(0,n.jsx)(x,{title:"Tournaments",color:"bg-green-500",children:h.map(t=>(0,n.jsx)(d,{tournament:t,currentBot:e,onJoin:v},t.id))})]})})}},9026:(e,t,r)=>{"use strict";r.d(t,{Nr:()=>s,Zm:()=>a,me:()=>n});var n=function(e){return e.UPCOMING="upcoming",e.ACTIVE="active",e.COMPLETED="completed",e}({});let s=30,a=30},9521:(e,t,r)=>{Promise.resolve().then(r.bind(r,7424))}},e=>{e.O(0,[441,255,358],()=>e(e.s=9521)),_N_E=e.O()}]);